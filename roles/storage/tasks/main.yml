---
- name: Install Parted
  apt:
    name:
      - parted
    state: present

- name: Wipe out any existing partitions on /dev/sda
  parted:
    device: /dev/sda
    label: gpt
    state: present

- name: Create a single GPT partition on /dev/sda
  parted:
    device: /dev/sda
    label: gpt
    number: 1
    state: present
    part_start: 1MiB
    part_end: 100%
    fs_type: ext4

- name: Turn off any swap on /dev/sda1
  command: swapoff /dev/sda1
  ignore_errors: true

- name: Wipe existing filesystem signatures on /dev/sda1
  command: wipefs -a /dev/sda1

- name: Format the partition as ext4
  filesystem:
    fstype: ext4
    dev: /dev/sda1

- name: Ensure /home exists
  file:
    path: /home
    state: directory

- name: Mount /dev/sda1 on /home and add to fstab
  mount:
    path: /home
    src: /dev/sda1
    fstype: ext4
    opts: defaults
    state: mounted
