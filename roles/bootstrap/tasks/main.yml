---
- name: Ensure apt keyring is installed (raw)
  raw: |
    apt-get update && apt-get install -y debian-archive-keyring
  changed_when: false

- name: Ensure minimal python3 is installed (raw)
  raw: |
    apt-get update && apt-get install -y python3-minimal
  changed_when: false

- name: Pause for 10 seconds to allow python3 installation to settle
  pause:
    seconds: 10

- name: Set the Python interpreter for future tasks
  set_fact:
    ansible_python_interpreter: /usr/bin/python3

- name: Install full python3 and openssh-server
  apt:
    name:
      - python3
      - openssh-server
    state: present
    update_cache: yes

- name: Generate root ed25519 keypair if not already present
  command: ssh-keygen -t ed25519 -f "{{ playbook_dir }}/../playbooks/files/root_id_ed25519" -N ''
  args:
    creates: "{{ playbook_dir }}/../playbooks/files/root_id_ed25519"