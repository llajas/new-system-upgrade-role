global:
  file_watch_config:
    min_poll_frequency: 250ms
    max_poll_frequency: 250ms

server:
  http_listen_port: 9080
  grpc_listen_port: 0
  log_level: info
  enable_runtime_reload: true

clients:
  - url: {{ promtail_loki_url }}
    follow_redirects: true
    enable_http2: true
    backoff_config:
      min_period: 500ms
      max_period: 5m
      max_retries: 10
    timeout: 10s

positions:
  filename: /var/lib/promtail/positions.yaml
  sync_period: 10s

limits_config:
  readline_rate: 10000
  readline_burst: 10000
  readline_rate_drop: true

scrape_configs:
  # ------------------------------------------------
  # A) SSH via /var/log/auth.log (primary)
  # ------------------------------------------------
  - job_name: ssh-authlog
    static_configs:
      - targets: [localhost]
        labels:
          host: {{ promtail_host_label | quote }}
          app: sshd
          job: ssh-authlog
          __path__: /var/log/auth.log

  # ------------------------------------------------
  # B) Optional: systemd journal (if used)
  #     - can be enabled later if auth.log disappears
  # ------------------------------------------------
  # - job_name: ssh-journal
  #   journal:
  #     labels:
  #       host: {{ promtail_host_label | quote }}
  #       app: sshd
  #       job: ssh-journal
  #     max_age: 24h
  #     path: /var/log/journal
  #   relabel_configs:
  #     - source_labels: ['__journal__systemd_unit']
  #       regex: 'ssh\.service|sshd\.service'
  #       action: keep
